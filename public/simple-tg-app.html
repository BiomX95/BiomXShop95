<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <meta name="referrer" content="no-referrer">
  <title>BiomX_Shop</title>
  <!-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π –∫–æ–ø–∏–∏ –∏ CDN –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ -->
  <script>
    // –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ - —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å CDN
    (function() {
      var script = document.createElement('script');
      script.src = 'https://telegram.org/js/telegram-web-app.js';
      script.onerror = function() {
        // –ï—Å–ª–∏ CDN –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
        console.log('CDN –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é Telegram WebApp JS');
        var fallbackScript = document.createElement('script');
        fallbackScript.src = '/telegram-web-app-emulator.js';
        document.head.appendChild(fallbackScript);
      };
      document.head.appendChild(script);
    })();
  </script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Roboto', Arial, sans-serif;
      background-color: var(--tg-theme-bg-color, #f5f5f5);
      color: var(--tg-theme-text-color, #000000);
    }
    
    .container {
      max-width: 100%;
      padding: 0;
      margin: 0 auto;
    }
    
    .header {
      padding: 12px 16px;
    }
    
    .shop-name {
      color: #f71a2c;
      font-size: 22px;
      font-weight: bold;
      margin: 0;
    }
    
    .banner {
      width: 100%;
      margin-bottom: 20px;
    }
    
    .banner img {
      width: 100%;
      border-radius: 8px;
      display: block;
    }
    
    .section-title {
      color: #333;
      font-size: 22px;
      font-weight: bold;
      margin: 20px 0 15px 16px;
      display: flex;
      align-items: center;
    }
    
    .section-title .icon {
      margin-right: 8px;
      color: #f71a2c;
    }
    
    .login-section {
      padding: 15px;
      background-color: #f9f9f9;
      border-radius: 8px;
      margin: 0 15px 20px;
    }
    
    .login-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 12px;
    }
    
    .login-description {
      font-size: 14px;
      color: #555;
      margin-bottom: 15px;
    }
    
    .input-field {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
      box-sizing: border-box;
      font-size: 16px;
    }
    
    .login-button {
      width: 100%;
      background-color: #f71a2c;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 12px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .packages-section {
      margin: 0 15px 20px;
    }
    
    .package-list {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    
    .package-item {
      background-color: white;
      border-radius: 8px;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .package-info {
      flex: 1;
    }
    
    .package-name {
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 5px;
    }
    
    .package-price {
      color: #666;
      font-size: 14px;
    }
    
    .package-button {
      background-color: #f71a2c;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
    }
    
    .payment-methods, .promo-section, .reviews-section {
      margin: 0 15px 20px;
    }
    
    .method-item, .promo-form {
      background-color: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 12px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .footer {
      background-color: #333;
      color: white;
      padding: 20px 15px;
      text-align: center;
      margin-top: 20px;
    }
    
    .social-links {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 15px 0;
    }
    
    .social-icon {
      width: 36px;
      height: 36px;
      background-color: #555;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .copyright {
      font-size: 12px;
      color: #aaa;
      margin-top: 15px;
    }
    
    .manager-section {
      background-color: #444;
      border-radius: 8px;
      padding: 15px;
      display: flex;
      align-items: center;
      margin-top: 20px;
    }
    
    .manager-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      margin-right: 15px;
    }
    
    .manager-info {
      flex: 1;
    }
    
    .manager-name {
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .manager-title {
      font-size: 12px;
      color: #ccc;
    }
    
    .message-button {
      background-color: #25D366;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 12px;
      display: flex;
      align-items: center;
      font-size: 14px;
      margin-left: 10px;
    }
    
    .status-message {
      color: #f71a2c;
      font-size: 14px;
      text-align: center;
      margin-top: 10px;
      display: none;
    }
    
    .nickname-display {
      font-size: 14px;
      color: #666;
      margin-top: 5px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <h1 class="shop-name">BiomX_Shop</h1>
    </header>
    
    <div class="banner">
      <img src="../assets/banner.png" alt="–ê–õ–ú–ê–ó–´ –ü–û –°–ö–ò–î–ö–ï">
    </div>
    
    <div id="login-view">
      <div class="section-title">
        <span class="icon">üë§</span>
        –í–æ–π—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω
      </div>
      
      <div class="login-section">
        <div class="login-title">–í–æ–π—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω</div>
        <div class="login-description">–í–≤–µ–¥–∏—Ç–µ ID –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ Free Fire –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è</div>
        
        <div class="form">
          <div class="form-group">
            <label for="game-id">ID –∏–≥—Ä–æ–∫–∞</label>
            <input type="text" id="game-id" class="input-field" placeholder="–í–≤–µ–¥–∏—Ç–µ ID Free Fire" pattern="[0-9]{5,12}">
            <div id="nickname-display" class="nickname-display"></div>
          </div>
          
          <button id="login-button" class="login-button">–í–æ–π—Ç–∏</button>
          <div id="status-message" class="status-message"></div>
        </div>
      </div>
    </div>
    
    <div id="packages-view" class="hidden">
      <div class="section-title">
        <span class="icon">üíé</span>
        –ö–∞—Ç–∞–ª–æ–≥ –∞–ª–º–∞–∑–æ–≤
      </div>
      
      <div class="packages-section">
        <div id="packages-list" class="package-list">
          <!-- –ü–∞–∫–µ—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
      </div>
      
      <div class="section-title">
        <span class="icon">üí≥</span>
        –°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã
      </div>
      
      <div class="payment-methods">
        <div class="method-item">
          <div class="method-name">Visa/Mastercard</div>
        </div>
        <div class="method-item">
          <div class="method-name">Qiwi</div>
        </div>
        <div class="method-item">
          <div class="method-name">–ÆMoney</div>
        </div>
      </div>
      
      <div class="section-title">
        <span class="icon">üè∑Ô∏è</span>
        –ü—Ä–æ–º–æ–∫–æ–¥
      </div>
      
      <div class="promo-section">
        <div class="promo-form">
          <input type="text" class="input-field" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥">
          <button class="login-button">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        </div>
      </div>
      
      <div class="section-title">
        <span class="icon">üí¨</span>
        –û—Ç–∑—ã–≤—ã
      </div>
      
      <div class="reviews-section">
        <div id="reviews-list">
          <!-- –û—Ç–∑—ã–≤—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
          <div style="text-align: center; padding: 20px; color: #666;">
            –ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤
          </div>
        </div>
      </div>
    </div>
    
    <footer class="footer">
      <div>
        <h3 class="shop-name">BiomX_Shop</h3>
        <p>–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω –∞–ª–º–∞–∑–æ–≤ Free Fire</p>
      </div>
      
      <div class="social-links">
        <a href="https://wa.me/+79659661395" target="_blank" class="social-icon">
          <span>WA</span>
        </a>
        <a href="https://t.me/BiomX_Garant" target="_blank" class="social-icon">
          <span>TG</span>
        </a>
        <a href="https://instagram.com/Biom_X" target="_blank" class="social-icon">
          <span>IG</span>
        </a>
        <a href="https://vk.com/biomxxx" target="_blank" class="social-icon">
          <span>VK</span>
        </a>
      </div>
      
      <div class="manager-section">
        <img src="../assets/images/manager-avatar.jpeg" alt="–¢–∏–º–µ—Ä–ª–∞–Ω" class="manager-avatar">
        <div class="manager-info">
          <div class="manager-name">–¢–∏–º–µ—Ä–ª–∞–Ω</div>
          <div class="manager-title">–ú–µ–Ω–µ–¥–∂–µ—Ä-–ø–æ–º–æ—â–Ω–∏–∫</div>
        </div>
        <a href="https://wa.me/+79899282649" target="_blank" class="message-button">
          <span>WhatsApp</span>
        </a>
      </div>
      
      <div class="copyright">
        &copy; 2024 BiomX_Shop. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
      </div>
    </footer>
  </div>
  
  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
    const tg = window.Telegram?.WebApp;
    
    // –ü–∞–∫–µ—Ç—ã –∞–ª–º–∞–∑–æ–≤
    const diamondPackages = [
      { id: 1, name: "100 + 5 –∞–ª–º–∞–∑–æ–≤", price: 90 },
      { id: 2, name: "310 + 16 –∞–ª–º–∞–∑–æ–≤", price: 260 },
      { id: 3, name: "520 + 26 –∞–ª–º–∞–∑–æ–≤", price: 429 },
      { id: 4, name: "1060 + 53 –∞–ª–º–∞–∑–æ–≤", price: 849 },
      { id: 5, name: "2180 + 218 –∞–ª–º–∞–∑–æ–≤", price: 1700 },
      { id: 6, name: "5600 + 560 –∞–ª–º–∞–∑–æ–≤", price: 4390 }
    ];
    
    // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã DOM
    const loginView = document.getElementById('login-view');
    const packagesView = document.getElementById('packages-view');
    const gameIdInput = document.getElementById('game-id');
    const nicknameDisplay = document.getElementById('nickname-display');
    const loginButton = document.getElementById('login-button');
    const statusMessage = document.getElementById('status-message');
    const packagesList = document.getElementById('packages-list');
    
    // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ Telegram WebApp
    if (tg) {
      console.log("Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
      
      // –ü–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ü–≤–µ—Ç–∞ –ø–æ–¥ —Ç–µ–º—É Telegram
      document.documentElement.style.setProperty('--button-color', tg.themeParams.button_color || '#f71a2c');
      document.documentElement.style.setProperty('--button-text-color', tg.themeParams.button_text_color || '#ffffff');
      
      // –°–æ–æ–±—â–∞–µ–º Telegram, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≥–æ—Ç–æ–≤–∞
      tg.ready();
      
      // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
      tg.MainButton.setText('–í—ã–±—Ä–∞—Ç—å –ø–∞–∫–µ—Ç –∞–ª–º–∞–∑–æ–≤');
      tg.MainButton.setParams({
        color: '#f71a2c',
        text_color: '#ffffff'
      });
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    function init() {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ—Ö—Ä–∞–Ω–µ–Ω –ª–∏ —É–∂–µ ID –∏–≥—Ä—ã
      const savedGameId = localStorage.getItem('gameId');
      
      // –ï—Å–ª–∏ –µ—Å—Ç—å ID –∏ –æ–Ω –≤–∞–ª–∏–¥–Ω—ã–π, —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–∫–µ—Ç—ã
      if (savedGameId && isValidGameId(savedGameId)) {
        gameIdInput.value = savedGameId;
        checkNickname(savedGameId);
        showPackages();
      }
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–∞–∫–µ—Ç—ã –∞–ª–º–∞–∑–æ–≤
      loadPackages();
      
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      loginButton.addEventListener('click', handleLogin);
      gameIdInput.addEventListener('input', handleGameIdInput);
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ ID –∏–≥—Ä—ã
    function isValidGameId(id) {
      return /^\d{5,12}$/.test(id);
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ ID –∏–≥—Ä—ã
    function handleGameIdInput() {
      const gameId = gameIdInput.value.trim();
      
      if (gameId.length >= 5) {
        checkNickname(gameId);
      } else {
        nicknameDisplay.textContent = '';
      }
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∏–∫–Ω–µ–π–º–∞
    function checkNickname(gameId) {
      fetch(`/api/user/nickname/${gameId}`)
        .then(response => response.json())
        .then(data => {
          if (data && data.nickname) {
            nicknameDisplay.textContent = data.nickname;
          } else {
            nicknameDisplay.textContent = '';
          }
        })
        .catch(error => {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–∏–∫–Ω–µ–π–º–∞:', error);
          nicknameDisplay.textContent = '';
        });
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥–∞
    function handleLogin() {
      const gameId = gameIdInput.value.trim();
      
      if (!isValidGameId(gameId)) {
        statusMessage.textContent = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID –∏–≥—Ä—ã (–æ—Ç 5 –¥–æ 12 —Ü–∏—Ñ—Ä)';
        statusMessage.style.display = 'block';
        return;
      }
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
      localStorage.setItem('gameId', gameId);
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–∫–µ—Ç—ã
      showPackages();
    }
    
    // –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç–æ–≤
    function showPackages() {
      // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —ç–∫—Ä–∞–Ω—ã
      loginView.classList.add('hidden');
      packagesView.classList.remove('hidden');
      
      // –ï—Å–ª–∏ –µ—Å—Ç—å Telegram WebApp, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
      if (tg) {
        tg.MainButton.show();
      }
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ –∞–ª–º–∞–∑–æ–≤
    function loadPackages() {
      packagesList.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π –ø–∞–∫–µ—Ç –≤ —Å–ø–∏—Å–æ–∫
      diamondPackages.forEach(pkg => {
        const packageEl = document.createElement('div');
        packageEl.className = 'package-item';
        packageEl.innerHTML = `
          <div class="package-info">
            <div class="package-name">${pkg.name}</div>
            <div class="package-price">${pkg.price} ‚ÇΩ</div>
          </div>
          <button class="package-button" onclick="selectPackage(${pkg.id})">–í—ã–±—Ä–∞—Ç—å</button>
        `;
        packagesList.appendChild(packageEl);
      });
    }
    
    // –í—ã–±–æ—Ä –ø–∞–∫–µ—Ç–∞ –∞–ª–º–∞–∑–æ–≤
    function selectPackage(packageId) {
      const gameId = localStorage.getItem('gameId');
      const packageInfo = diamondPackages.find(p => p.id === packageId);
      
      if (!packageInfo) return;
      
      console.log(`–í—ã–±—Ä–∞–Ω –ø–∞–∫–µ—Ç: ${packageInfo.name} –¥–ª—è ID: ${gameId}`);
      
      // –ï—Å–ª–∏ –µ—Å—Ç—å Telegram WebApp, –∑–∞–∫—Ä—ã–≤–∞–µ–º —Å –¥–∞–Ω–Ω—ã–º–∏
      if (tg) {
        tg.sendData(JSON.stringify({
          action: 'select_package',
          gameId: gameId,
          packageId: packageId,
          packageName: packageInfo.name,
          packagePrice: packageInfo.price
        }));
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º WebApp
        tg.close();
      } else {
        // –ï—Å–ª–∏ —ç—Ç–æ –æ–±—ã—á–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç
        window.location.href = `/?action=select_package&game_id=${gameId}&package_id=${packageId}`;
      }
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ URL-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    function processUrlParams() {
      const urlParams = new URLSearchParams(window.location.search);
      const gameId = urlParams.get('game_id');
      
      if (gameId && isValidGameId(gameId)) {
        gameIdInput.value = gameId;
        localStorage.setItem('gameId', gameId);
        checkNickname(gameId);
        showPackages();
      }
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É URL-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    document.addEventListener('DOMContentLoaded', () => {
      processUrlParams();
      init();
    });
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é selectPackage –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
    window.selectPackage = selectPackage;
  </script>
</body>
</html>